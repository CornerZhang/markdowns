## Amdahl定律

&emsp;&emsp;利用Amdahl定律，可以计算出通过改进计算机系统某一部分而能获得的性能增益。Amdahl 定律表明，使用某种快速执行模式获得的性能改进受限于可使用此种快速执行方式的时间比例。Amdahl 定律定义了使用某一特定功能所获得的加速比（ speedup ）。加速比是什么？假定我们可以对某一计算机系统进行某种升级，在采用这一升级时可以提高计算机的整体性能。加速比的定义为：


$$ 加速比 = \dfrac { 整个任务在采用该升级时的性能 } { 整个任务在未采用该升级时的性能 } $$

或者:

$$ 加速比 = \dfrac { 整个任务在未采用该升级时的执行时间 } { 整个任务在采用该升级时的执行时间 } $$

加速比告诉我们，与原计算机相比，在经过升级的计算机系统上运行一个任务可以加快多少。

&emsp;&emsp;Amdahl 定律为我们提供了一种快速方法，用来计算某一升级所得到的加速比，加速比取决
于下面两个因素。

1. 原计算机系统计算时间中可升级部分所占的比例。例如，一个程序的总执行时间为ω 秒，如果有20 秒的执行时间可进行升级，那这个比例就是20/60。我们将这个值称为升级比例，它总是小于或等于１。
2. 通过升级执行模式得到的改进，也就是说在为整个程序使用这一执行模式时，任务的运行速度会提高多少倍。这个值等于原模式的执府时间除以升级模式的执行时间。如果为程序的某一部分采用升级模式后需要2 秒，而在原始模式中需要5 秒，则提升值为5/2。我们将这个值称为升级加速比，它总是大于１。

原计算机系统采用升级模式后的执行时间等于该计算机未升级部分耗用的时间加上使用升级部分耗用的时间：


$$ 新执行时间 = 原执行时间 \times ( (1-升级比例)＋\dfrac{升级比例}{升级加速比} ) $$

总加速比是这两个执行时间之比：

$$ 总加速比 = \dfrac{原执行时间}{新执行时间} = \dfrac{1}{(1-升级比例)+\dfrac{升级比例}{升级加速比}} ​$$

> 例如：图形处理器中经常需要的一种转换是求平方根。浮点（ FP ）平方根的实现在性能方面有很大差异，特别是在为图形设计的处理器中，尤为明显。假设FP 平方根( FPSQR ）占用→项关键图形基准测试中20%的执行时间。有一项提议z 升级FPSQR 硬件，使这一运算速度提高到原来的10 倍。另一项提议是让图形处理器中所有FP 指令的运行速度提高到原来的1.6 倍， FP 指令占用该应用程序一半的执行时间。设计团队相信，他们使所有FP 指令执行速度提高到1.6 倍所需要的工作量与加快平方根运算的工作量相同。试比较这两种设计方案。
>
> 求解：
>
> &emsp;&emsp;可以通过计算加速比来对比两种方案
>
> $$ 加速比_{FPSQR} = \dfrac{1}{(1-0.2)+ \dfrac{0.2}{10}} = \dfrac{1}{0.82} = 1.22 $$
>
> $$ 加速比_{FP} = \dfrac{1}{(1-0.5)+ \dfrac{0.5}{1.6}} = \dfrac{1}{0.8125} = 1.23 $$
>
> &emsp;&emsp;提高整体FP运算的性能要稍好些，原因是它的使用频率较高。

&emsp;&emsp;Amdahl 定律阐述了一个回报递减规律：如果仅改进一部分计算的性能，在增加改进时，所获得的加速比增量会逐渐减小。Amdahl 定律有一个重要推论：若某一升级仅对一项任务的一部分适用，则该任务的总加速比不会超过一个数值，该数值即1 减去未升级部分所占比例，再取其倒数。

&emsp;&emsp;在应用Amdahl定律时的一个常见错误是混淆“可升级部分在升级之前所占时间比例”和“升级部分在升级之后所占时间比例”。如果我们测量的不是计算中可以应用该升级的时间，而是测试应用升级之后的时间，结果就是错误的！Amdahl定律可用来判断某项升级能使性能提高多少，以及如何分配资源来提高性价比。分配目标显然是：某一部分的升级资源应当与这一部分原来花费的时间成比例。Amdahl定律对于比较两种系统的整体系统性能尤其有用，也可用于比较两种处理器设计。 

